//! This module contains an implementation of the approximation of the principal
//! branch of the Lambert W function
//! with 24 bits of accuracy from Fukushima's paper.
//! It returns [`f32::NAN`] if the input is negative or `NAN`,
//! and [`f32::INFINITY`] if the input is positive infinity.

use crate::generic_math::{ln, rational_function, sqrt};

const NEG_INV_E: f32 = super::NEG_INV_E as f32;

#[inline(always)]
#[cfg_attr(all(test, assert_no_panic), no_panic::no_panic)]
pub fn sw0f(z: f32) -> f32 {
    if z < NEG_INV_E || z.is_nan() {
        f32::NAN
    } else if z <= 2.0082178115844726563 {
        // W <= 0.854, X_1

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                -0.9999999403954018833,
                0.05573005216177780273,
                2.1269732491053174421,
                0.8135112367835287880,
                0.016324880146070158165,
            ],
            [
                1.0,
                2.2759065598634651182,
                1.3675970138689040829,
                0.18615823452831621870,
            ],
        )
    } else if z <= 30.539142109510895244 {
        // W <= 2.502, X_2

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                -0.98551970905999093351,
                1.0774975733813516259,
                0.87175103068177496565,
                0.054352728608275766374,
            ],
            [
                1.0,
                1.1861014037015433637,
                0.24996298430828162221,
                0.0068813686486759124002,
            ],
        )
    } else if z <= 371.66984371375776070 {
        // W <= 4.430, X_3

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                -0.76239711346368884239,
                1.2317731613363595833,
                0.24342447113056694510,
                0.0043206013938782355974,
            ],
            [
                1.0,
                0.57938621503586907609,
                0.046601427736078777155,
                0.00043512817567474109142,
            ],
        )
    } else if z <= 4705.9189542659690377 {
        // W <= 6.574, X_4

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                0.085801247434391388025,
                0.82539798099748343722,
                0.039781960760329074310,
                0.00018785578927583799084,
            ],
            [
                1.0,
                0.21338076817080141022,
                0.0054626720397926935553,
                0.000015449534481294754830,
            ],
        )
    } else if z <= 64640.797355310089675 {
        // W <= 8.892, X_5

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                1.6219245383470168742,
                0.38869145132516663564,
                0.0045750642678503511111,
                5.5384672148644498873e-6,
            ],
            [
                1.0,
                0.065219460735182414183,
                0.00047882760789022508940,
                3.8094828146292401099e-7,
            ],
        )
    } else if z <= 965_649.030_871_163_2 {
        // W <= 11.351, X_6

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                3.6218996085695919969,
                0.14884646754880159869,
                0.00042469622409998403146,
                1.2790179710374216846e-7,
            ],
            [
                1.0,
                0.017985659319608747571,
                0.000035446449757357845802,
                7.5062492963037047005e-9,
            ],
        )
    } else if z <= 1.559_333_422_803_816_6e7 {
        // W <= 13.928, X_7

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                5.9073369739608090589,
                0.050053653594737112977,
                0.000034072148625204698714,
                2.4812064693655483492e-9,
            ],
            [
                1.0,
                0.0046558990016843210488,
                2.3449445860808812050e-6,
                1.2631429964808461140e-10,
            ],
        )
    } else if z <= 2.7025640277241903157e8 {
        // W <= 16.605, X_8

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                8.3826005848195512671,
                0.015360346475232500605,
                2.4433384397869367445e-6,
                4.1856803264118549639e-11,
            ],
            [
                1.0,
                0.0011507423223785867830,
                1.4221428474813516408e-7,
                1.8739172026620122637e-12,
            ],
        )
    } else if z <= 4.9950187397041946355e9 {
        // W <= 19.368, X_9

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                10.996674803992550975,
                0.0043942138898673832456,
                1.5966665354846778026e-7,
                6.2665382844968732242e-13,
            ],
            [
                1.0,
                0.00027383757675703647431,
                8.0157062319690304209e-9,
                2.4956982158871730002e-14,
            ],
        )
    } else if z <= 9.7911154416726960277e10 {
        // W <= 22.207, X_10

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                13.719833802350861158,
                0.0011874443805202291429,
                9.6303381200164675971e-9,
                8.4434524232261628808e-15,
            ],
            [
                1.0,
                0.000063056372424395349289,
                4.2358766031098840291e-10,
                3.0205405005434474304e-16,
            ],
        )
    } else if z <= 2.0259753856302099683e12 {
        // W <= 25.114, X_11

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                16.533119481561616886,
                0.00030583125751908040646,
                5.4112946633720098731e-10,
                1.0347130333704711275e-16,
            ],
            [
                1.0,
                0.000014099161212376339883,
                2.1121095412354695063e-11,
                3.3526927157452469515e-18,
            ],
        )
    } else if z <= 4.4077444251477938939e13 {
        // W <= 28.082, X_12

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                19.423519260478579324,
                0.000075559269761977808773,
                2.8530023120783075984e-11,
                1.1629627096463579569e-18,
            ],
            [
                1.0,
                3.0692092789727855657e-6,
                9.9866613050311465475e-13,
                3.4376717116983915038e-20,
            ],
        )
    } else if z <= 1.0048382150571504485e15 {
        // W <= 31.106, X_13

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                22.381576050041913103,
                0.000017994724029162552053,
                1.4194876420402230259e-12,
                1.2071105154385829867e-20,
            ],
            [
                1.0,
                6.5183962806656770340e-7,
                4.4958665712812536150e-14,
                3.2755429245023581532e-22,
            ],
        )
    } else if z <= 2.3932552602359837687e16 {
        // W <= 34.182, X_14

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                25.400105417092068195,
                4.1467378386579246015e-6,
                6.6962697219681791539e-14,
                1.1637905159506476082e-22,
            ],
            [
                1.0,
                1.3529801357030416819e-7,
                1.9336081785325750353e-15,
                2.9149396199816257636e-24,
            ],
        )
    } else if z <= 5.9397996597465754346e17 {
        // W <= 37.306, X_15

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                28.473455626379917708,
                9.2746824693094059019e-7,
                3.0068990159336805287e-15,
                1.0473557591822027852e-24,
            ],
            [
                1.0,
                2.7486489704521729110e-8,
                7.9678987071036133398e-17,
                2.4331666367061529366e-26,
            ],
        )
    } else if z <= 1.5326938589901766592e19 {
        // W <= 40.475, X_16

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                31.597055437846359378,
                2.0184225276786325496e-7,
                1.2895788196512908898e-16,
                8.8361174714101098159e-27,
            ],
            [
                1.0,
                5.4723945126098497202e-9,
                3.1537729179929191758e-18,
                1.9122035132571670022e-28,
            ],
        )
    } else if z <= 4.1035659398885394135e20 {
        // W <= 43.687, X_17

        rational_function(
            sqrt(z - NEG_INV_E),
            [
                34.767124490414517175,
                4.2830799240698942932e-8,
                5.2975884121036534407e-18,
                7.0145515392158775378e-29,
            ],
            [
                1.0,
                1.0689301127696332436e-9,
                1.2016699061789422951e-19,
                1.4195244810800985235e-30,
            ],
        )
    } else if z < f32::INFINITY {
        // W <= 319.673, U_18

        rational_function(
            ln(z),
            [
                -0.60702373371846192476,
                0.69828716322526983651,
                0.075795135081824754660,
                0.00051669256081737246814,
            ],
            [
                1.0,
                0.079048429972306018289,
                0.00051760990899205978468,
                -4.2438403931981069786e-10,
            ],
        )
    } else {
        f32::INFINITY
    }
}
