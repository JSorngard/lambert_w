//! This module contains an implementation of the approximation of the principal
//! branch of the Lambert W function
//! with 50 bits of accuracy from Fukushima's paper.
//! It returns [`f64::NAN`] if the input is negative or `NAN`,
//! and [`f64::INFINITY`] if the input is positive infinity.

use crate::generic_math::{ln, rational_function, sqrt};

/// zc = z + 1/e
#[inline(always)]
#[cfg_attr(all(test, assert_no_panic), no_panic::no_panic)]
pub fn dw0c(zc: f64) -> f64 {
    if zc < 0.0 || zc.is_nan() {
        f64::NAN
    } else if zc <= 2.5498939065034735716 {
        // W <= 0.893, X_1

        rational_function(
            sqrt(zc),
            [
                -0.9999999999999998890,
                -2.7399668668203659304,
                0.026164207726990399347,
                6.370916807894900917,
                7.101328651785402668,
                2.9800826783006852573,
                0.48819596813789865043,
                0.023753035787333611915,
                0.00007736576009377243100,
            ],
            [
                1.0,
                5.071610848417428005,
                9.986838818354528337,
                9.660755192207886908,
                4.7943728991336119052,
                1.1629703477704522300,
                0.11849462500733755233,
                0.0034326525132402226488,
            ],
        )
    } else if zc <= 43.613924462669367895 {
        // W <= 2.754, X_2

        rational_function(
            sqrt(zc),
            [
                -0.99997801800578916749,
                -0.70415751590483602272,
                2.1232260832802529071,
                2.3896760702935718341,
                0.77765311805029175244,
                0.089686698993644741433,
                0.0033062485753746403559,
                0.000025106760479132851033,
            ],
            [
                1.0,
                3.0356026828085410884,
                3.1434530151286777057,
                1.3723156566592447275,
                0.25844697415744211142,
                0.019551162251819044265,
                0.00048775933244530123101,
                2.3165116841073152717e-6,
            ],
        )
    } else if zc <= 598.453_533_718_782_8 {
        // W <= 4.821, X_3

        rational_function(
            sqrt(zc),
            [
                -0.98967420337273506393,
                0.59587680606394382748,
                1.4225083018151943148,
                0.44882889168323809798,
                0.044504943332390033511,
                0.0015218794835419578554,
                0.000016072263556502220023,
                3.3723373020306510843e-8,
            ],
            [
                1.0,
                1.6959402394626198052,
                0.80968573415500900896,
                0.14002034999817021955,
                0.0093571878493790164480,
                0.00023251487593389773464,
                1.8060170751502988645e-6,
                2.5750667337015924224e-9,
            ],
        )
    } else if zc <= 8049.4919850757619109 {
        // W <= 7.041, X_4

        rational_function(
            sqrt(zc),
            [
                -0.77316491997206225517,
                1.1391333504296703783,
                0.43116117255217074492,
                0.035773078319037507449,
                0.00096441640580559092740,
                8.9723854598675864757e-6,
                2.5623503144117723217e-8,
                1.4348813778416631453e-11,
            ],
            [
                1.0,
                0.74657287456514418083,
                0.12629777033419350576,
                0.0069741512959563184881,
                0.00014089339244355354892,
                1.0257432883152943078e-6,
                2.2902687190119230940e-9,
                9.2794231013264501664e-13,
            ],
        )
    } else if zc <= 111124.95412121781420 {
        // W <= 9.380, X_5

        rational_function(
            sqrt(zc),
            [
                0.12007101671553688430,
                0.83352640829912822896,
                0.070142775916948337582,
                0.0014846357985475124849,
                0.000010478757366110155290,
                2.5715892987071038527e-8,
                1.9384214479606474749e-11,
                2.8447049039139409652e-15,
            ],
            [
                1.0,
                0.25396738845619126630,
                0.012839238907330317393,
                0.00020275375632510997371,
                1.1482956073449141384e-6,
                2.3188370605674263647e-9,
                1.4271994165742563419e-12,
                1.5884836942394796961e-16,
            ],
        )
    } else if zc <= 1.5870429812082297112e6 {
        // W <= 11.809, X_6

        rational_function(
            sqrt(zc),
            [
                1.7221104439937710112,
                0.39919594286484275605,
                0.0079885540140685028937,
                0.000042889742253257920541,
                7.8146828180529864981e-8,
                4.9819638764354682359e-11,
                9.7650889714265294606e-15,
                3.7052997281721724439e-19,
            ],
            [
                1.0,
                0.074007438118020543008,
                0.0010333501506697740545,
                4.4360858035727508506e-6,
                6.7822912316371041570e-9,
                3.6834356707639492021e-12,
                6.0836159560266041168e-16,
                1.8149869335981225316e-20,
            ],
        )
    } else if zc <= 2.3414708401875459509e7 {
        // W <= 14.308, X_7

        rational_function(
            sqrt(zc),
            [
                3.7529314023434544256,
                0.15491342690357806525,
                0.00075663140675900784505,
                1.0271609235969979059e-6,
                4.7853247675930066150e-10,
                7.8328040770275474410e-14,
                3.9433033758391036653e-18,
                3.8232862205660283978e-23,
            ],
            [
                1.0,
                0.020112985338854443555,
                0.000074712286154830141768,
                8.4800598003693837469e-8,
                3.4182424130376911762e-11,
                4.8866259139690957899e-15,
                2.1223373626834634178e-19,
                1.6642985671260582515e-24,
            ],
        )
    } else if zc <= 3.5576474308009965225e8 {
        // W <= 16.865, X_8

        rational_function(
            sqrt(zc),
            [
                6.0196542055606555577,
                0.053496672841797864762,
                0.000064340849275316501519,
                2.1969090100095967485e-8,
                2.5927988937033061070e-12,
                1.0779198161801527308e-16,
                1.3780424091017898301e-21,
                3.3768973150742552802e-27,
            ],
            [
                1.0,
                0.0052809683704233371675,
                5.1020501219389558082e-6,
                1.5018312292270832103e-9,
                1.5677706636413188379e-13,
                5.7992041238911878361e-18,
                6.5133170770320780259e-23,
                1.3205080139213406071e-28,
            ],
        )
    } else if zc <= 5.5501716296163627854e9 {
        // W <= 19.468, X_9

        rational_function(
            sqrt(zc),
            [
                8.4280268500989701597,
                0.017155758546279713315,
                5.0836620669829321508e-6,
                4.3354903691832581802e-10,
                1.2841017145645583385e-14,
                1.3419106769745885927e-19,
                4.3101698455492225750e-25,
                2.6422433422088187549e-31,
            ],
            [
                1.0,
                0.0013572006754595300315,
                3.3535243481426203694e-7,
                2.5206969246421264128e-11,
                6.7136226273060530496e-16,
                6.3324226680854686574e-21,
                1.8128167400013774194e-26,
                9.3662030058136796889e-33,
            ],
        )
    } else if zc <= 8.8674704839657775331e10 {
        // W <= 22.112, X_10

        rational_function(
            sqrt(zc),
            [
                10.931063230472498189,
                0.0052224234540245532982,
                3.7996105711810129682e-7,
                8.0305793533410355824e-12,
                5.9139785627090605866e-17,
                1.5382020359533028724e-22,
                1.2288944126268109432e-28,
                1.8665089270660122398e-35,
            ],
            [
                1.0,
                0.00034328702551197577797,
                2.1395351518538844476e-8,
                4.0524170186631594159e-13,
                2.7181424315335710420e-18,
                6.4538986638355490894e-24,
                4.6494613785888987942e-30,
                6.0442024367299387616e-37,
            ],
        )
    } else if zc <= 1.4477791865272902816e12 {
        // W <= 24.791, X_11

        rational_function(
            sqrt(zc),
            [
                13.502943080893871412,
                0.0015284636506346264572,
                2.7156967358262346166e-8,
                1.4110394051242161772e-13,
                2.5605734311219728461e-19,
                1.6421293724425337463e-25,
                3.2324944691435843553e-32,
                1.2054662641251783155e-39,
            ],
            [
                1.0,
                0.000085701512879089462255,
                1.3311244435752691563e-9,
                6.2788924440385347269e-15,
                1.0483788152252204824e-20,
                6.1943499966249160886e-27,
                1.1101567860340917294e-33,
                3.5897381128308962590e-41,
            ],
        )
    } else if zc <= 2.4111458632511851931e13 {
        // W <= 27.500, X_12

        rational_function(
            sqrt(zc),
            [
                16.128076167439014775,
                0.00043360385176467069131,
                1.8696403871820916466e-9,
                2.3691795766901486045e-15,
                1.0503191826963154893e-21,
                1.6461927573606764263e-28,
                7.9138276083474522931e-36,
                7.1845890343701668760e-44,
            ],
            [
                1.0,
                0.000021154255263102938752,
                8.1006115442323280538e-11,
                9.4155986022169905738e-17,
                3.8725127902295302254e-23,
                5.6344651115570565066e-30,
                2.4860951084210029191e-37,
                1.9788304737427787405e-45,
            ],
        )
    } else if zc <= 4.0897036442600845564e14 {
        // W <= 30.236, X_13

        rational_function(
            sqrt(zc),
            [
                18.796301105534486604,
                0.00011989443339646469157,
                1.2463377528676863250e-10,
                3.8219456858010368172e-17,
                4.1055693930252083265e-24,
                1.5595231456048464246e-31,
                1.8157173553077986962e-39,
                3.9807997764326166245e-48,
            ],
            [
                1.0,
                5.1691031988359922329e-6,
                4.8325571823313711932e-12,
                1.3707888746916928107e-18,
                1.3754560850024480337e-25,
                4.8811882975661805184e-33,
                5.2518641828170201894e-41,
                1.0192119593134756440e-49,
            ],
        )
    } else if zc <= 7.0555901476789972402e15 {
        // W <= 32.996, X_14

        rational_function(
            sqrt(zc),
            [
                21.500582830667332906,
                0.000032441943237735273768,
                8.0764963416837559148e-12,
                5.9488445506122883523e-19,
                1.5364106187215861531e-26,
                1.4033231297002386995e-34,
                3.9259872712305770430e-43,
                2.0629086382257737517e-52,
            ],
            [
                1.0,
                1.2515317642433850197e-6,
                2.8310314214817074806e-13,
                1.9423666416123637998e-20,
                4.7128616004157359714e-28,
                4.0433347391839945960e-36,
                1.0515141443831187271e-44,
                4.9316490935436927307e-54,
            ],
        )
    } else if zc <= 1.2366607557976727287e17 {
        // W <= 35.779, X_15

        rational_function(
            sqrt(zc),
            [
                24.235812532416977267,
                8.6161505995776802509e-6,
                5.1033431561868273692e-13,
                8.9642393665849638164e-21,
                5.5254364181097420777e-29,
                1.2045072724050605792e-37,
                8.0372997176526840184e-47,
                1.0049140812146492611e-56,
            ],
            [
                1.0,
                3.0046761844749477987e-7,
                1.6309104270855463223e-14,
                2.6842271030298931329e-22,
                1.5619672632458881195e-30,
                3.2131689030397984274e-39,
                2.0032396245307684134e-48,
                2.2520274554676331938e-58,
            ],
        )
    } else if zc <= 2.1999373487930999775e18 {
        // W <= 38.582, X_16

        rational_function(
            sqrt(zc),
            [
                26.998134347987436511,
                2.2512257767572285866e-6,
                3.1521230759866963941e-14,
                1.3114035719790631541e-22,
                1.9156784033962366146e-31,
                9.8967003053444799163e-41,
                1.5640423898448433548e-50,
                4.6216193040664872606e-61,
            ],
            [
                1.0,
                7.1572676370907573898e-8,
                9.2500506091115760826e-16,
                3.6239819582787573031e-24,
                5.0187712493800424118e-33,
                2.4565861988218069039e-42,
                3.6435658433991660284e-52,
                9.7432490640155346004e-63,
            ],
        )
    } else if zc <= 3.9685392198344016155e19 {
        // W <= 41.404, X_17

        rational_function(
            sqrt(zc),
            [
                29.784546702831970770,
                5.7971764392171329944e-7,
                1.9069872792601950808e-15,
                1.8668700870858763312e-24,
                6.4200510953370940075e-34,
                7.8076624650818968559e-44,
                2.9029638696956315654e-54,
                2.0141870458566179853e-65,
            ],
            [
                1.0,
                1.6924463180469706372e-8,
                5.1703934311254540111e-17,
                4.7871532721560069095e-26,
                1.5664405832545149368e-35,
                1.8113137982381331398e-45,
                6.3454150289495419529e-56,
                4.0072964025244397967e-67,
            ],
        )
    } else if zc <= 1.4127075145274652069e104 {
        // W <= 234.358, U_18

        rational_function(
            ln(zc),
            [
                0.74413499460126776143,
                0.41403243618005911160,
                0.26012564166773416170,
                0.021450457095960295520,
                0.00051872377264705907577,
                4.3574693568319975996e-6,
                1.2363066058921706716e-8,
                9.0194147766309957537e-12,
            ],
            [
                1.0,
                0.33487811067467010907,
                0.023756834394570626395,
                0.00054225633008907735160,
                4.4378980052579623037e-6,
                1.2436585497668099330e-8,
                9.0225825867631852215e-12,
                -4.2057836270109716654e-19,
            ],
        )
    } else if zc < f64::INFINITY {
        //   U_19

        rational_function(
            ln(zc),
            [
                -0.61514412812729761526,
                0.67979310133630936580,
                0.089685353704585808963,
                0.0015644941483989379249,
                7.7349901878176351162e-6,
                1.2891647546699435229e-8,
                7.0890325988973812656e-12,
                9.8419790334279711453e-16,
            ],
            [
                1.0,
                0.097300263710401439315,
                0.0016103672748442058651,
                7.8247741003077000012e-6,
                1.2949261308971345209e-8,
                7.0986911219342827130e-12,
                9.8426285042227044979e-16,
                -1.5960147252606055352e-24,
            ],
        )
    } else {
        f64::INFINITY
    }
}
